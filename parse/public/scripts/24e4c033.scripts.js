"use strict";angular.module("parseAngularTodoodlyApp",["ngRoute","ngStorage","ui.bootstrap","parseRestApi","angularFileUpload"]).config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",resolve:{auth:["$q","session","auth",function(a,b,c){return c(!1,"/todos",!0)}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",resolve:{auth:["$q","session","auth",function(a,b,c){return c(!1,"/todos",!0)}]}}).when("/signin",{templateUrl:"views/signin.html",controller:"SigninCtrl",resolve:{auth:["$q","session","auth",function(a,b,c){return c(!1,"/todos",!0)}]}}).when("/todos",{templateUrl:"views/todos.html",controller:"TodosCtrl",resolve:{auth:["$q","session","auth",function(a,b,c){return c(!0,"/home",!1)}]}}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl",resolve:{auth:["$q","session","auth",function(a,b,c){return c(!0,"/home",!1)}]}}).otherwise({redirectTo:"/home"})}]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeError",function(a,c,d,e){e&&e.redirectPath?b.path(e.redirectPath):e&&e.replacePath&&(b.path(e.replacePath),b.replace())})}]).config(["$httpProvider",function(a){a.interceptors.push("parseRestApiInterceptor")}]),angular.module("parseAngularTodoodlyApp").run(["parseInitialize",function(a){var b="EyFXIlvfGNpyMxSsKX2PuEowMFt8TwnA012jAr8P",c="wHqWaDlBgYAs245Boeqr4wSzaIEtL4L02Myj23Od";a(b,c)}]),angular.module("parseAngularTodoodlyApp").factory("session",["parseSession",function(a){var b=a;return Object.defineProperty(b,"todos",{enumerable:!1,configurable:!0,value:[]}),b}]),angular.module("parseAngularTodoodlyApp").factory("Todo",["parseObjectFactory",function(a){var b=a("Todo");return b.prototype.toggleDone=function(){this.isDone=!this.isDone,this.$save()},b}]),angular.module("parseAngularTodoodlyApp").factory("User",["ParseUser","Todo","session",function(a,b,c){var d=a;return d.prototype.getTodos=function(){return b.query({where:{user:this.getPointer()},order:"-createdAt"},function(a){var b=c.todos,d=[0,b.length].concat(a);[].splice.apply(b,d)})},d.signOut=function(){var a=d.signOut;return function(){c.todos.splice(0,c.todos.length),a()}}(),Object.defineProperty(c,"refreshTodos",{enumerable:!1,configurable:!1,value:function(){return c.user.getTodos()}}),d.prototype.addTodo=function(a){var c=new b({content:a,isDone:!1,user:this.getPointer()});return c.setUserPriveleges(this,!0,!0),c.$save(),c},d}]),angular.module("parseAngularTodoodlyApp").directive("tdSiteHeader",function(){return{templateUrl:"views/site-header.html",restrict:"E",replace:!0}}),angular.module("parseAngularTodoodlyApp").directive("tdSiteFooter",function(){return{templateUrl:"views/site-footer.html",restrict:"E",replace:!0}}),angular.module("parseAngularTodoodlyApp").directive("tdMatches",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=function(b){var e=a[c.tdMatches];return d.$isEmpty(b)||b===e?(d.$setValidity("matches",!0),b):void d.$setValidity("matches",!1)};d.$parsers.push(e),d.$formatters.push(e)}}}),angular.module("parseAngularTodoodlyApp").directive("tdPristineWhileFocused",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=function(a){return d.$setPristine(),a},f=function(){a.$apply(function(){d.$dirty=!0,d.$prisine=!1})};b.on("focus",e),d.$parsers.push(e),b.on("change",f)}}}),angular.module("parseAngularTodoodlyApp").directive("tdValidOnUpdate",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=function(b){var e=c.tdValidOnUpdate.split(" ");return angular.forEach(e,function(b){var c,e,f=b.split(".");1===f.length?(e=d,c=f[0]):(c=f.pop(),e=a,angular.forEach(f,function(a){e=e[a]})),e.$setValidity(c,!0)}),b};d.$parsers.push(e),d.$formatters.push(e)}}}),angular.module("parseAngularTodoodlyApp").directive("tdEscape",function(){var a=27;return{restrict:"A",link:function(b,c,d){c.bind("keydown",function(c){c.keyCode===a&&b.$apply(d.tdEscape)})}}}),angular.module("parseAngularTodoodlyApp").directive("tdGiveFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.tdGiveFocus,function(b){b&&a(function(){c[0].focus()},0,!1)})}}}]),angular.module("parseAngularTodoodlyApp").controller("HomeCtrl",function(){}),angular.module("parseAngularTodoodlyApp").controller("AboutCtrl",function(){}),angular.module("parseAngularTodoodlyApp").controller("SignupCtrl",["$scope","$location","User",function(a,b,c){a.signup=function(){c.signUp(this.email,this.password,this.email).$promise.then(function(){b.path("/todos"),b.replace()},function(b){var c=b.data.code;switch(c){case 202:a.signupform.email.$setValidity("available",!1)}})}}]),angular.module("parseAngularTodoodlyApp").controller("SigninCtrl",["$scope","$location","User",function(a,b,c){a.signin=function(){c.signIn(this.email,this.password).$promise.then(function(){b.path("/todos"),b.replace()},function(b){var c=b.data.code;switch(c){case 101:a.signinform.email.$setValidity("registered",!1),a.signinform.password.$setValidity("registered",!1)}})}}]),angular.module("parseAngularTodoodlyApp").controller("SiteHeaderCtrl",["$scope","$location","User","session",function(a,b,c,d){a.isAuthenticated=function(){return d.isAuthenticated},a.signOut=function(){c.signOut(),b.path("/home"),b.replace()}}]),angular.module("parseAngularTodoodlyApp").controller("TodosCtrl",["$scope","session",function(a,b){if(b.isAuthenticated){var c=b.user,d=a.todos=b.todos;c.getTodos(),a.addTodo=function(){var a=c.addTodo(this.addTodoContent);d.unshift(a),this.addTodoContent=""},a.toggleDone=function(a){a.toggleDone()},a.editTodo=function(b){a.editedTodo=b,a.originalTodoContent=b.content},a.doneEditing=function(b){a.originalTodoContent=a.editedTodo=null,b.content=b.content.trim(),b.$save(),b.content||a.deleteTodo(b)},a.revertEditing=function(b){b.content=a.originalTodoContent,a.originalTodoContent=a.editedTodo=null},a.deleteTodo=function(a){d.splice(d.indexOf(a),1),a.$delete()}}}]),angular.module("parseAngularTodoodlyApp").factory("auth",["$q","session",function(a,b){return function(c,d,e){var f={},g=e?"replacePath":"redirectPath";return f[g]=d,!!b.isAuthenticated===c?!0:a.reject(f)}}]);var scope;angular.module("parseAngularTodoodlyApp").controller("ProfileCtrl",["$scope","$modal","$location","session",function(a,b,c,d){scope=a;var e=!1;a.user=d.user,a.editUser=function(a){this.editedProp=a,this.origPropVal=this.user[a]},a.doneEditing=function(){var b,c=this.editedProp,f=this.origPropVal;e||(this.origPropVal=this.editedProp=null,this.user[c]!==f&&(e=!0,b=this.user.$save(),b.then(null,function(){var b=arguments[0].data;console.log(b),d.refreshUser().$promise.then(function(){a.user=d.user})}),b.finally(function(){e=!1})))},a.revertEditing=function(){console.log("revertEditing"),this.user[this.editedProp]=this.origPropVal,this.origPropVal=this.editedProp=null},a.uploadPhoto=function(){b.open({templateUrl:"views/upload-photo.html",controller:["$scope","$modalInstance","$upload",function(a,b,c){a.onFileSelect=function(b){for(var d=0;d<b.length;d++){var e=b[d];console.log(e),a.upload=c.upload({url:"https://api.parse.com/1/files/"+e.name,file:e}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){console.log(a)})}},a.upload=function(){console.log(this.file),b.close()},a.cancel=function(){b.dismiss("cancel")}}]})},a.confirmDelete=function(){var a=b.open({templateUrl:"views/delete-user.html",controller:["$scope","$modalInstance",function(a,b){a.deleteUser=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]});a.result.then(function(){var a=d.user,b=a.constructor;a.$delete().then(function(){b.signOut(),c.path("/home"),c.replace()})},function(){})}}]),angular.module("parseAngularTodoodlyApp").filter("iif",function(){return function(a,b,c){return a?b:c}}),angular.module("parseAngularTodoodlyApp").directive("tdEnter",function(){var a=13;return{restrict:"A",link:function(b,c,d){c.bind("keydown",function(c){c.keyCode===a&&b.$apply(d.tdEnter)})}}});